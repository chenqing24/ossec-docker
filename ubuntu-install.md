#ubunut14.04 安装ossec-server
###环境:
2台ubunt 14.04
192.168.0.2  server
192.168.0.3  client
###安装步骤
服务端和客户端: 安装依赖环境

```
#apt-get install build-essential make libssl-dev git
```
 
服务端: 安装apache, mysql, php

```
# apt-get install mysql-server libmysqlclient-dev mysql-client apache2 php5 libapache2-mod-php5 php5-mysql php5-curl php5-gd php5-intl php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-ming php5-ps php5-pspell php5-recode php5-snmp php5-sqlite php5-tidy php5-xmlrpc php5-xsl
# mysql_secure_installation  #配置数据库
# /etc/init.d/apache2 restart
# /etc/init.d/mysql restart
```

服务端和客户端: 下载ossec hids

```
#wget https://bintray.com/artifact/download/ossec/ossec-hids/ossec-hids-2.8.3.tar.gz
#tar xvzf ossec-hids-2.8.3.tar.gz
#cd ossec-hids-2.8.3

```
服务端: 数据库调整

```
#cd src
#make setdb   #配置使用mysql数据库
Error: PostgreSQL client libraries not installed.
Info: Compiled with MySQL support.
#cd ../
#./install.sh   #除下方标红参数外，其他使用默认参数
What kind of installation do you want (server, agent, local, hybrid or help)? server
#/var/ossec/bin/ossec-control restart
```
服务端: 配置数据库

```
mysql -u root -p
Enter password:
[...]

mysql> create database ossec;
Query OK, 1 row affected (0.00 sec)

grant INSERT,SELECT,UPDATE,CREATE,DELETE,EXECUTE on ossec.* to ossec_u;
Query OK, 0 rows affected (0.00 sec)

set password for ossec_u = PASSWORD('Passw0rd');
Query OK, 1 row affected (0.00 sec)

flush privileges;
Query OK, 0 rows affected (0.00 sec)

quit;

```
服务端: 导入数据
 

```
mysql -u root -p ossec < src/os_dbd/mysql.schema
```
服务端: 添加ossec数据库配置

```
# vi /var/ossec/etc/ossec.conf
 
<ossec_config>
    <database_output>
        <hostname>127.0.0.1</hostname>
        <username>ossec_u</username>
        <password>Passw0rd</password>
        <database>ossec</database>
        <type>mysql</type>
    </database_output>
</ossec_config>
```
服务端: 重启服务
 

```
/var/ossec/bin/ossec-control enable database
/var/ossec/bin/ossec-control restart 
```
服务端: 安装ossec web ui
 

```
wget https://github.com/ossec/ossec-wui/archive/v0.8.tar.gz
tar -xvzf ossec-wui-0.8.tar.gz
mkdir -p /var/www/html/ossec/tmp/
mv ossec-wui-0.8/* /var/www/html/ossec/
chown www-data:www-data /var/www/html/ossec/tmp/
chmod 666 /var/www/html/ossec/tmp
usermod -a -G ossec www-data

```
服务端: 安装analogi web dashboard
 

```
cd /var/www/html/
git clone https://github.com/ECSC/analogi.git
cp analogi/db_ossec.php.new analogi/db_ossec.php
vim analogi/db_ossec.php   修改数据库配置
define ('DB_USER_O', 'ossec_u');
define ('DB_PASSWORD_O', 'Passw0rd');
define ('DB_HOST_O', '127.0.0.1');
define ('DB_NAME_O', 'ossec');
```
访问http://{your_ip_address}/analogi/
客户端: 安装ossec
 
```
# ./install.sh #除标红配置外，其他选择默认
1- What kind of installation do you want (server, agent, local, hybrid or help)? agent
3.1- What's the IP Address or hostname of the OSSEC HIDS server?:192.168.0.2
```
服务端: 添加客户端
 

```
# /var/ossec/bin/manage_agents
****************************************
* OSSEC HIDS v2.8 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: A

- Adding a new agent (use '\q' to return to the main menu).
  Please provide the following:
   * A name for the new agent: ossec-client1
   * The IP Address of the new agent: 2.3.4.5
   * An ID for the new agent[001]: 
Agent information:
   ID:001
   Name:ossec-client1
   IP Address:2.3.4.5

Confirm adding it?(y/n): y
Agent added.

```
服务端: 为客户端生成key

```
# /var/ossec/bin/manage_agents

****************************************
* OSSEC HIDS v2.8 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: E

Available agents:
   ID: 001, Name: ossec-client1, IP: 2.3.4.5
Provide the ID of the agent to extract the key (or '\q' to quit): 001

Agent key information for '001' is:
SD[...]AAUjd=

** Press ENTER to return to the main menu.
```
 
客户端: 添加server配置

```
# /var/ossec/bin/manage_agents

****************************************
* OSSEC HIDS v2.8 Agent manager.     *
* The following options are available: *
****************************************
   (I)mport key from the server (I).
   (Q)uit.
Choose your action: I or Q: i

* Provide the Key generated by the server.
* The best approach is to cut and paste it.
*** OBS: Do not include spaces or new lines.

Paste it here (or '\q' to quit): SD[...]AAUjd=

Agent information:
   ID:001
   Name:ossec-client1
   IP Address:2.3.4.5

Confirm adding it?(y/n): y
Added.
** Press ENTER to return to the main menu.
```
 
客户端: 查看添加配置

```
# cat /var/ossec/etc/ossec.conf
<client>
  <server-hostname>1.2.3.4</server-hostname>
</client>
```
服务端，客户端: 重启服务

```
# /var/ossec/bin/ossec-control restart
```
 
参考资料:
https://raymii.org/s/tutorials/OSSEC_2.8.0_Server_Client_and_Analogi_Dashboard_on_Ubuntu.html
http://prolinuxhub.com/installing-ossec-2-8-3-on-centos-7-client-server-mode/


